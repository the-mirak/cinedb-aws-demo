---
description:
globs:
alwaysApply: false
---
---
description: SAM template and Infrastructure as Code best practices
globs: ["sam/**/*.yaml", "sam/**/*.yml", "**/*template*.yaml"]
alwaysApply: false
---

# SAM Infrastructure Standards

## SAM Template Structure
- Use SAM CLI version 1.0+ syntax
- Organize resources by logical grouping
- Use consistent naming conventions (PascalCase for resources)
- Include proper descriptions for all resources
- Use Parameters for environment-specific values

## Lambda Function Definitions
```yaml
GetAllMoviesFunction:
  Type: AWS::Serverless::Function
  Properties:
    CodeUri: backend/lambda_functions/get_all_movies/
    Handler: lambda_function.lambda_handler
    Runtime: python3.9
    MemorySize: 256
    Timeout: 30
    Environment:
      Variables:
        DYNAMODB_TABLE: !Ref MoviesTable
        S3_BUCKET: !Ref PosterBucket
    Events:
      GetMovies:
        Type: Api
        Properties:
          RestApiId: !Ref CineDBApi
          Path: /movies
          Method: GET
```

## API Gateway Configuration
- Use explicit CORS configuration
- Define proper request/response models
- Include binary media types for file uploads
- Set appropriate timeout values
- Configure proper error responses

## DynamoDB Tables
- Define proper attribute definitions
- Use appropriate provisioned capacity
- Include global secondary indexes if needed
- Set up proper backup and point-in-time recovery
- Use consistent naming conventions

## S3 Buckets
- Configure proper CORS policies
- Set up lifecycle policies for cost optimization
- Include versioning configuration
- Define proper bucket policies for security
- Use consistent bucket naming

## IAM Roles and Policies
- Follow least-privilege principle
- Use managed policies where appropriate
- Define custom policies for specific needs
- Include proper resource ARN patterns
- Document policy purposes

## Environment Variables
- Use Parameters for environment-specific values
- Define default values where appropriate
- Use consistent naming conventions
- Document all required variables
- Group related variables logically
