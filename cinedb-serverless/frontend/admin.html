<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineDB - Admin Dashboard</title>
    <link rel="stylesheet" href="static/css/tailwind.css">
</head>
<body class="bg-neutral-900 min-h-screen text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <header class="bg-neutral-800 shadow-lg rounded-lg mb-8">
            <div class="px-6 py-5 flex justify-between items-center">
                <h1 class="text-3xl font-bold text-amber-400">CineDB Admin</h1>
                <div class="flex items-center">
                    <div id="demo-mode-badge" class="hidden bg-amber-900/50 text-amber-300 px-3 py-1 rounded-md text-sm font-medium flex items-center mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        Demo Mode
                    </div>
                    <nav class="flex space-x-4">
                        <a href="index.html" class="px-4 py-2 rounded-md text-sm font-medium bg-neutral-700 text-white hover:bg-neutral-600 transition-colors">Home</a>
                        <a href="#" id="logout-link" class="px-4 py-2 rounded-md text-sm font-medium bg-red-600 text-white hover:bg-red-700 transition-colors">Logout</a>
                    </nav>
                </div>
            </div>
        </header>
        
        <main>
            <div class="mb-8 flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-white">Movie Management</h2>
                <a href="add_movie.html" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-md font-medium inline-flex items-center transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    Add New Movie
                </a>
            </div>
            
            <div id="movie-list" class="grid grid-cols-1 gap-6">
                <!-- Movies will be loaded dynamically here -->
                <div class="loading flex justify-center items-center p-12">
                    <svg class="animate-spin h-10 w-10 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="ml-3 text-lg text-neutral-400">Loading movies...</span>
                </div>
            </div>
        </main>
        
        <footer class="mt-12 py-6 border-t border-neutral-700">
            <p class="text-center text-neutral-400">&copy; 2023 CineDB</p>
        </footer>
    </div>

    <script src="static/js/api-client.js?v=1682284330"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.12/dist/amazon-cognito-identity.min.js"></script>
    <script src="static/js/cognito-config.js"></script>
    <script src="static/js/auth.js?v=1762631991"></script>
    <script src="static/js/poster-generator.js"></script>
    <script>
        // Protect this page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is authenticated
            protectAdminPage();
            
            // Show demo mode badge if demo mode is active
            if (isDemoMode()) {
                document.getElementById('demo-mode-badge').classList.remove('hidden');
            }
            
            // Set up logout link
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Perform normal logout (no confirmation dialogs)
                logout();
                
                // Redirect to login page instead of home page
                window.location.href = 'login.html';
            });
            
            // Fetch and display movies with admin controls
            fetchMovies()
                .then(movies => {
                    const container = document.getElementById('movie-list');
                    
                    if (!movies || movies.length === 0) {
                        container.innerHTML = '<div class="no-movies text-center py-12 text-neutral-400">No movies found</div>';
                        return;
                    }
                    
                    container.innerHTML = movies.map(movie => {
                        // Generate a poster if none exists
                        const posterUrl = movie.poster || generatePosterPlaceholder(movie.title || 'Movie');
                        
                        return `
                            <div class="movie-card bg-neutral-800 rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300">
                                <div class="md:flex">
                                    <div class="md:flex-shrink-0 relative">
                                        <img class="h-48 w-full object-cover md:w-48" src="${posterUrl}" alt="${movie.title} poster" onerror="this.src = generatePosterPlaceholder('${movie.title.replace(/'/g, "\\'")}')">
                                        <div class="absolute top-2 left-2 inline-flex items-center px-2.5 py-0.5 rounded-md bg-amber-700 text-white text-sm font-medium">
                                            <svg class="h-3.5 w-3.5 mr-1 text-amber-300" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118l-2.8-2.034c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                            </svg>
                                            ${movie.rating}
                                        </div>
                                    </div>
                                    <div class="p-6 flex-1">
                                        <div class="flex items-baseline">
                                            <h3 class="text-xl font-semibold text-white">${movie.title}</h3>
                                            <div class="ml-3 text-sm text-neutral-400">${movie.year} â€¢ ${movie.duration}</div>
                                        </div>
                                        <p class="mt-2 text-neutral-300">${movie.synopsis}</p>
                                        <div class="mt-4 flex space-x-3">
                                            <a href="edit_movie.html?id=${movie.id}" class="bg-neutral-700 hover:bg-neutral-600 text-white px-4 py-2 rounded-md font-medium inline-flex items-center transition-colors">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                </svg>
                                                Edit
                                            </a>
                                            <button class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium inline-flex items-center transition-colors" onclick="deleteMovieHandler('${movie.id}')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                </svg>
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('movie-list').innerHTML = 
                        `<div class="bg-red-900/20 border border-red-900/30 text-red-200 p-4 rounded-md">
                            Error loading movies: ${error.message}
                        </div>`;
                });
        });
        
        // Handle movie deletion
        function deleteMovieHandler(id) {
            if (confirm('Are you sure you want to delete this movie?')) {
                deleteMovie(id)
                    .then(success => {
                        if (success) {
                            alert('Movie deleted successfully!');
                            window.location.reload();
                        }
                    })
                    .catch(error => {
                        alert(`Error deleting movie: ${error.message}`);
                    });
            }
        }
    </script>

    <style>
        /* Remove the toggle switch styles since they're no longer needed */
    </style>
</body>
</html> 