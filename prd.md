# CineDB AWS Serverless Refactoring Project Requirements Document

## Project Overview
This document outlines the specific requirements for refactoring the existing CineDB Flask application into a serverless architecture using AWS services. The refactoring will follow AWS best practices for serverless applications while leveraging the CineDB's existing functionality.

## Requirements

| Requirement ID | Description | User Story | Expected Behavior/Outcome |
|----------------|-------------|------------|---------------------------|
| **S3-01** | Host static website content on S3 | As a developer, I want to extract and convert the Flask templates (index.html, admin.html, edit_movie.html, add_movie.html) into static files hosted on S3 so that I can leverage AWS's scalable storage and delivery capabilities. | The extracted static HTML, CSS, and JavaScript files are uploaded to an S3 bucket with website hosting enabled. The files contain client-side code to communicate with API Gateway endpoints. |
| **S3-02** | Configure CloudFront distribution for S3 website | As a developer, I want to create a CloudFront distribution in front of my S3 bucket so that users can access the website via a secure, global content delivery network. | A CloudFront distribution is created with the S3 bucket as its origin, using an Origin Access Identity for security. The distribution has proper cache behaviors and is accessible via HTTPS. |
| **S3-03** | Set up S3 bucket for movie poster storage | As a developer, I want to create a dedicated S3 bucket for movie poster images with appropriate CORS configuration so that the application can securely store and retrieve image files. | A separate S3 bucket is created for poster images with proper CORS headers allowing access from the website domain. The bucket has appropriate lifecycle policies and permissions. |
| **DDB-01** | Create DynamoDB table for movie data | As a developer, I want to create a DynamoDB table with the appropriate schema to store movie information (id, title, rating, synopsis, poster URL) so that data can be efficiently accessed and stored. | A DynamoDB table is created with a partition key on 'id', containing the same fields currently used in the Flask application's data model. The table has appropriate provisioned capacity. |
| **DDB-02** | Implement data migration from existing source | As a developer, I want to create a script to migrate existing movie data to DynamoDB so that the serverless application has the same dataset as the original application. | A migration script successfully transfers all existing movie data to the DynamoDB table, preserving all attributes and relationships. |
| **LAMBDA-01** | Create Lambda function for retrieving all movies | As a developer, I want to implement a Lambda function that scans the DynamoDB table and generates presigned URLs for the movie posters so that the frontend can display the movie catalog. | A Lambda function that performs the same operations as the index route in app.py, returning a JSON response containing all movies with presigned URLs for their poster images. |
| **LAMBDA-02** | Create Lambda function for retrieving a single movie | As a developer, I want to implement a Lambda function that retrieves a specific movie by ID so that the frontend can display detailed information about a selected movie. | A Lambda function that queries DynamoDB for a specific movie ID, generates a presigned URL for its poster, and returns the movie details in a structured JSON response. |
| **LAMBDA-03** | Create Lambda function for adding new movies | As a developer, I want to implement a Lambda function that handles the creation of new movies, including poster image upload to S3, so that administrators can add new movies to the catalog. | A Lambda function that processes multipart form data, uploads the poster image to S3, creates a new record in DynamoDB with a generated UUID, and returns a success response. |
| **LAMBDA-04** | Create Lambda function for updating movies | As a developer, I want to implement a Lambda function that handles updating existing movie information, including poster replacement if needed, so that administrators can modify movie details. | A Lambda function that updates DynamoDB records based on form input, handles optional poster image updates to S3, and returns the updated movie information. |
| **LAMBDA-05** | Create Lambda function for deleting movies | As a developer, I want to implement a Lambda function that removes movies from the database and deletes their associated poster images so that administrators can remove content from the catalog. | A Lambda function that deletes a record from DynamoDB based on its ID, identifies and removes the associated poster image from S3, and returns a success response. |
| **LAMBDA-06** | Create Lambda function for generating presigned URLs | As a developer, I want to implement a dedicated Lambda function for generating S3 presigned URLs so that the application can provide secure, temporary access to poster images. | A Lambda function that accepts a poster key or full URL, generates a presigned URL with configurable expiration time, and returns the URL for client access. |
| **APIGW-01** | Create API Gateway REST API | As a developer, I want to create a REST API in API Gateway to expose the Lambda functions so that the frontend can interact with the serverless backend. | An API Gateway REST API is created with resources for movies (/movies, /movies/{id}) and appropriate HTTP methods (GET, POST, PUT, DELETE) connected to the correct Lambda functions. |
| **APIGW-02** | Configure request/response mappings for API | As a developer, I want to configure proper request/response mappings in API Gateway so that data flows correctly between the frontend and Lambda functions. | API Gateway is configured with appropriate request templates for processing form data and file uploads, and response templates for returning consistent JSON structures. |
| **APIGW-03** | Enable CORS for API Gateway | As a developer, I want to enable CORS for the API Gateway endpoints so that the frontend hosted on a different domain can successfully make requests to the API. | API Gateway has CORS enabled for all methods, with appropriate headers allowing requests from the CloudFront distribution domain. OPTIONS methods are configured for preflight requests. |
| **APIGW-04** | Create API Gateway deployment stage | As a developer, I want to create a deployment stage for the API so that the frontend can access a stable, versioned API endpoint. | An API Gateway deployment stage (e.g., 'prod') is created and deployed, providing a functional endpoint URL for frontend integration. |
| **COGNITO-01** | Create Cognito User Pool for admin authentication | As a developer, I want to create a Cognito User Pool to handle administrator authentication so that the admin section is properly secured. | A Cognito User Pool is created with appropriate password policies, account recovery settings, and at least one admin user configured. |
| **COGNITO-02** | Configure Cognito App Client | As a developer, I want to create a Cognito App Client for the frontend application so that it can authenticate users against the User Pool. | A Cognito App Client is configured with appropriate OAuth flows, callback URLs matching the frontend, and necessary scopes for admin operations. |
| **COGNITO-03** | Create Cognito authorizer for API Gateway | As a developer, I want to create a Cognito authorizer in API Gateway so that admin endpoints require valid authentication. | A Cognito User Pool authorizer is created in API Gateway and applied to the admin endpoints (/admin, POST/PUT/DELETE methods on /movies), validating JWT tokens from authenticated users. |
| **COGNITO-04** | Implement authentication flow in frontend | As a developer, I want to implement the Cognito authentication flow in the frontend JavaScript so that users can log in to access the admin functionality. | The frontend JavaScript implements Cognito authentication using the Amplify library or similar, with login/logout functionality and secure token storage. |
| **SAM-01** | Create SAM template for Lambda functions | As a developer, I want to create a SAM template that defines all Lambda functions with their appropriate settings so that they can be consistently deployed. | A SAM template (template.yaml) defines all Lambda functions with appropriate handlers, memory settings, timeout values, and environment variables. |
| **SAM-02** | Create SAM template for API Gateway | As a developer, I want to extend the SAM template to include API Gateway configuration so that the API is deployed consistently with the Lambda functions. | The SAM template includes API Gateway resources, methods, integrations, and authorizers, connected to the Lambda functions in a coherent architecture. |
| **SAM-03** | Create SAM template for DynamoDB and S3 | As a developer, I want to include DynamoDB and S3 resource definitions in the SAM template so that the entire infrastructure can be deployed as code. | The SAM template includes definitions for the DynamoDB table and S3 buckets with appropriate properties and permissions. |
| **SAM-04** | Create SAM template for Cognito resources | As a developer, I want to include Cognito resources in the SAM template so that the authentication infrastructure is deployed consistently. | The SAM template includes Cognito User Pool, App Client, and IAM role definitions with appropriate settings and policies. |
| **SAM-05** | Configure IAM roles and policies | As a developer, I want to define appropriate IAM roles and policies in the SAM template so that each component has least-privilege permissions. | The SAM template includes IAM roles for Lambda functions with specific policies for DynamoDB read/write, S3 access, and Cognito operations as needed. |
| **SAM-06** | Create deployment scripts and documentation | As a developer, I want to create deployment scripts and documentation so that the application can be easily deployed to different environments. | Shell scripts or Makefile targets are created for deploying the SAM template, with documentation on prerequisites and parameters. |

## Module Sequencing for Training
The requirements above are organized to follow a logical progression through AWS services for a training course:

1. First module: S3 (Requirements S3-01, S3-02, S3-03)
2. Second module: DynamoDB (Requirements DDB-01, DDB-02) 
3. Third module: Lambda (Requirements LAMBDA-01 through LAMBDA-06)
4. Fourth module: API Gateway (Requirements APIGW-01 through APIGW-04)
5. Fifth module: Cognito (Requirements COGNITO-01 through COGNITO-04)
6. Sixth module: SAM (Requirements SAM-01 through SAM-06)
